{% extends 'base.html' %}

{% block title %}缓存检查器 - 图书管理系统{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>缓存检查器</h2>
        <a href="{% url 'cache_stats' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> 返回统计
        </a>
    </div>

    <!-- 总体信息 -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <h4>{{ total_keys }}</h4>
                    <p class="text-muted">总缓存项</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <h4>{{ namespaced_keys|length }}</h4>
                    <p class="text-muted">命名空间数量</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <h4>{{ stats.hit_rate }}%</h4>
                    <p class="text-muted">命中率</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 命名空间详情 -->
    <div class="row">
        {% for namespace, keys in namespaced_keys.items %}
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>
                        <i class="bi bi-folder"></i>
                        {{ namespace|title }}
                    </h5>
                    <span class="badge bg-primary">{{ keys|length }} 项</span>
                </div>
                <div class="card-body">
                    {% if keys %}
                        <div class="list-group" style="max-height: 300px; overflow-y: auto;">
                            {% for key in keys %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <small class="font-monospace text-break">{{ key }}</small>
                                <span class="badge bg-secondary">{{ keys|length }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted text-center">该命名空间为空</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- 操作说明 -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>使用说明</h5>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li>缓存检查器显示当前系统中所有缓存项的详细信息</li>
                        <li>缓存项按命名空间分组，便于管理和调试</li>
                        <li>点击缓存项可以查看详细信息（开发模式下）</li>
                        <li>定期清理过期缓存可以释放内存空间</li>
                        <li>高命中率通常表示缓存配置良好</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}